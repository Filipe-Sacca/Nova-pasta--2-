<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>An√°lise Completa - M√≥dulo de Picking iFood</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        
        article {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
            margin-bottom: 30px;
        }
        
        h2 {
            color: #34495e;
            border-bottom: 2px solid #e8f4f8;
            padding-bottom: 8px;
            margin-top: 35px;
            margin-bottom: 20px;
        }
        
        h3 {
            color: #2c3e50;
            margin-top: 25px;
            margin-bottom: 15px;
        }
        
        .critical-section {
            background: #ffebee;
            border-left: 4px solid #e74c3c;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        
        .success-section {
            background: #e8f5e8;
            border-left: 4px solid #27ae60;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        
        .info-section {
            background: #e8f4f8;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        
        .warning-section {
            background: #fef9e7;
            border-left: 4px solid #f39c12;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        
        code {
            background: #f5f5f5;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', 'Courier New', monospace;
            font-size: 14px;
        }
        
        pre {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-left: 4px solid #007acc;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.4;
        }
        
        .endpoint {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }
        
        .endpoint-header {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .method {
            background: #28a745;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .method.post { background: #28a745; }
        .method.patch { background: #ffc107; color: #333; }
        .method.delete { background: #dc3545; }
        
        .status-pending { color: #e74c3c; font-weight: bold; }
        .status-critical { color: #ffffff; background: #e74c3c; padding: 2px 6px; border-radius: 3px; }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        th, td {
            border: 1px solid #dee2e6;
            padding: 12px;
            text-align: left;
        }
        
        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }
        
        tbody tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        .workflow-step {
            background: #ffffff;
            border: 2px solid #3498db;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
            position: relative;
        }
        
        .workflow-step::before {
            content: counter(step-counter);
            counter-increment: step-counter;
            background: #3498db;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            top: -15px;
            left: 15px;
            font-weight: bold;
        }
        
        .workflow-container {
            counter-reset: step-counter;
        }
        
        .integration-requirements {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .integration-requirements h3 {
            color: white;
            margin-top: 0;
        }
        
        ul li {
            margin-bottom: 8px;
        }
        
        .emphasis {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <article>
        <header>
            <h1>üìã An√°lise Completa - M√≥dulo de Picking iFood</h1>
        </header>
        
        <main>
            <div class="critical-section">
                <h3>üö® Status Cr√≠tico - Bloqueador para Homologa√ß√£o</h3>
                <p><strong>Implementa√ß√£o atual:</strong> <span class="status-critical">0/5 endpoints (0%)</span></p>
                <p><strong>Impacto:</strong> O m√≥dulo de Picking √© <strong>obrigat√≥rio</strong> para a homologa√ß√£o oficial do iFood. Sem ele, n√£o √© poss√≠vel processar pedidos corretamente.</p>
            </div>

            <section>
                <h2>üìñ Vis√£o Geral do M√≥dulo</h2>
                
                <div class="info-section">
                    <h3>‚ÑπÔ∏è O que √© o M√≥dulo de Picking?</h3>
                    <p>O m√≥dulo de Picking √© respons√°vel pela <strong>gest√£o de separa√ß√£o de pedidos</strong> na plataforma iFood. Ele permite:</p>
                    <ul>
                        <li>Iniciar e finalizar processos de separa√ß√£o de pedidos</li>
                        <li>Modificar itens durante a separa√ß√£o (adicionar, editar, remover)</li>
                        <li>Ajustar quantidades e pesos de produtos</li>
                        <li>Gerenciar situa√ß√µes de falta de estoque</li>
                        <li>Garantir que o pedido final reflita exatamente o que foi separado</li>
                    </ul>
                </div>

                <div class="warning-section">
                    <h3>‚ö†Ô∏è Casos de Uso Cr√≠ticos</h3>
                    <ul>
                        <li><strong>Falta de estoque:</strong> Remover itens indispon√≠veis durante a separa√ß√£o</li>
                        <li><strong>Varia√ß√µes de peso:</strong> Ajustar produtos vendidos por peso (ex: cliente pediu 500g, produto pesou 490g)</li>
                        <li><strong>Substitui√ß√µes:</strong> Trocar produtos por similares durante a separa√ß√£o</li>
                        <li><strong>Controle de qualidade:</strong> Remover produtos com qualidade inadequada</li>
                    </ul>
                </div>
            </section>

            <section>
                <h2>üîó Endpoints Obrigat√≥rios</h2>
                
                <div class="endpoint">
                    <div class="endpoint-header">
                        <span class="method post">POST</span> 
                        <code>/picking/v1.0/orders/{orderId}/startSeparation</code>
                        <span class="status-pending">[N√ÉO IMPLEMENTADO]</span>
                    </div>
                    <p><strong>Finalidade:</strong> Iniciar o processo de separa√ß√£o de um pedido espec√≠fico</p>
                    <p><strong>Par√¢metros:</strong></p>
                    <ul>
                        <li><code>orderId</code> - ID √∫nico do pedido a ser separado</li>
                    </ul>
                    <p><strong>Headers obrigat√≥rios:</strong></p>
                    <pre>Authorization: Bearer {token}
Content-Type: application/json
x-merchant-id: {merchantId}</pre>
                </div>

                <div class="endpoint">
                    <div class="endpoint-header">
                        <span class="method post">POST</span> 
                        <code>/orders/{id}/items</code>
                        <span class="status-pending">[N√ÉO IMPLEMENTADO]</span>
                    </div>
                    <p><strong>Finalidade:</strong> Adicionar um novo item ao pedido durante a separa√ß√£o</p>
                    <p><strong>Par√¢metros:</strong></p>
                    <ul>
                        <li><code>id</code> - ID do pedido</li>
                        <li><strong>Body:</strong> Dados do item a ser adicionado (estrutura a ser documentada)</li>
                    </ul>
                </div>

                <div class="endpoint">
                    <div class="endpoint-header">
                        <span class="method patch">PATCH</span> 
                        <code>/orders/{id}/items/{uniqueId}</code>
                        <span class="status-pending">[N√ÉO IMPLEMENTADO]</span>
                    </div>
                    <p><strong>Finalidade:</strong> Editar um item existente no pedido durante a separa√ß√£o</p>
                    <p><strong>Par√¢metros:</strong></p>
                    <ul>
                        <li><code>id</code> - ID do pedido</li>
                        <li><code>uniqueId</code> - ID √∫nico do item no pedido</li>
                        <li><strong>Body:</strong> Dados atualizados do item</li>
                    </ul>
                </div>

                <div class="endpoint">
                    <div class="endpoint-header">
                        <span class="method delete">DELETE</span> 
                        <code>/orders/{id}/items/{uniqueId}</code>
                        <span class="status-pending">[N√ÉO IMPLEMENTADO]</span>
                    </div>
                    <p><strong>Finalidade:</strong> Remover um item do pedido durante a separa√ß√£o</p>
                    <p><strong>Par√¢metros:</strong></p>
                    <ul>
                        <li><code>id</code> - ID do pedido</li>
                        <li><code>uniqueId</code> - ID √∫nico do item a ser removido</li>
                    </ul>
                </div>

                <div class="endpoint">
                    <div class="endpoint-header">
                        <span class="method post">POST</span> 
                        <code>/endSeparation</code>
                        <span class="status-pending">[N√ÉO IMPLEMENTADO]</span>
                    </div>
                    <p><strong>Finalidade:</strong> Finalizar o processo de separa√ß√£o e confirmar as altera√ß√µes</p>
                    <p><strong>Observa√ß√£o:</strong> As altera√ß√µes s√≥ s√£o aplicadas efetivamente ap√≥s este endpoint ser chamado</p>
                </div>
            </section>

            <section>
                <h2>üîÑ Fluxo de Trabalho</h2>
                
                <div class="workflow-container">
                    <div class="workflow-step">
                        <h4>Iniciar Separa√ß√£o</h4>
                        <p>Chamar <code>POST /startSeparation</code> com o ID do pedido</p>
                        <p><strong>Resultado:</strong> Sistema entra em modo de separa√ß√£o para aquele pedido</p>
                    </div>

                    <div class="workflow-step">
                        <h4>Modificar Itens (Opcional)</h4>
                        <p>Durante a separa√ß√£o, pode-se:</p>
                        <ul>
                            <li>Adicionar itens com <code>POST /orders/{id}/items</code></li>
                            <li>Editar itens com <code>PATCH /orders/{id}/items/{uniqueId}</code></li>
                            <li>Remover itens com <code>DELETE /orders/{id}/items/{uniqueId}</code></li>
                        </ul>
                    </div>

                    <div class="workflow-step">
                        <h4>Valida√ß√µes</h4>
                        <p>O sistema realiza valida√ß√µes autom√°ticas:</p>
                        <ul>
                            <li>Pedido existe e √© v√°lido</li>
                            <li>Produtos adicionados existem no cat√°logo da loja</li>
                            <li>Regras de pagamento s√£o respeitadas</li>
                            <li>Valores adicionais s√£o permitidos</li>
                        </ul>
                    </div>

                    <div class="workflow-step">
                        <h4>Finalizar Separa√ß√£o</h4>
                        <p>Chamar <code>POST /endSeparation</code> para confirmar</p>
                        <p><strong>Importante:</strong> Pode falhar devido a regras espec√≠ficas de pagamento ou cobran√ßa adicional</p>
                    </div>

                    <div class="workflow-step">
                        <h4>Verifica√ß√£o Final</h4>
                        <p>Consultar os detalhes do pedido novamente para obter a vers√£o atualizada com todas as modifica√ß√µes aplicadas</p>
                    </div>
                </div>
            </section>

            <section>
                <h2>üìã Requisitos Funcionais</h2>
                
                <table>
                    <thead>
                        <tr>
                            <th>Requisito</th>
                            <th>Descri√ß√£o</th>
                            <th>Criticidade</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Iniciar Separa√ß√£o</td>
                            <td>Capacidade de iniciar processo de separa√ß√£o de pedidos</td>
                            <td>üî¥ Cr√≠tico</td>
                        </tr>
                        <tr>
                            <td>Gest√£o de Itens</td>
                            <td>Adicionar, editar e remover itens durante separa√ß√£o</td>
                            <td>üî¥ Cr√≠tico</td>
                        </tr>
                        <tr>
                            <td>Finalizar Separa√ß√£o</td>
                            <td>Confirmar altera√ß√µes e finalizar processo</td>
                            <td>üî¥ Cr√≠tico</td>
                        </tr>
                        <tr>
                            <td>Valida√ß√£o de Regras</td>
                            <td>Respeitar regras de neg√≥cio do iFood</td>
                            <td>üü° Alto</td>
                        </tr>
                        <tr>
                            <td>Tratamento de Erros</td>
                            <td>Gerenciar falhas na finaliza√ß√£o da separa√ß√£o</td>
                            <td>üü° Alto</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <section>
                <h2>‚öôÔ∏è Requisitos N√£o Funcionais</h2>
                
                <div class="integration-requirements">
                    <h3>üîê Autentica√ß√£o e Autoriza√ß√£o</h3>
                    <ul>
                        <li>Renovar token apenas quando prestes a expirar</li>
                        <li>Utilizar headers obrigat√≥rios em todas as requisi√ß√µes</li>
                        <li>Respeitar pol√≠ticas de rate limit dos endpoints</li>
                    </ul>
                </div>

                <div class="warning-section">
                    <h3>‚ö†Ô∏è Regras de Sequ√™ncia Obrigat√≥rias</h3>
                    <ul>
                        <li><strong>NUNCA</strong> finalizar separa√ß√£o antes de inici√°-la</li>
                        <li><strong>NUNCA</strong> tentar alterar itens ap√≥s conclus√£o da separa√ß√£o</li>
                        <li><strong>SEMPRE</strong> consultar detalhes do pedido ap√≥s separa√ß√£o para vers√£o atualizada</li>
                        <li><strong>SEMPRE</strong> tratar erros de valida√ß√£o na finaliza√ß√£o</li>
                    </ul>
                </div>

                <div class="emphasis">
                    <h4>üéØ Comportamentos Esperados</h4>
                    <ul>
                        <li>Implementar logs detalhados para auditoria</li>
                        <li>Retry com exponential backoff para falhas tempor√°rias</li>
                        <li>Valida√ß√£o de dados antes de envio para API</li>
                        <li>Cache de respostas quando apropriado</li>
                    </ul>
                </div>
            </section>

            <section>
                <h2>üèóÔ∏è Impacto na Arquitetura Atual</h2>
                
                <div class="info-section">
                    <h3>üìÅ Estrutura de Arquivos Sugerida</h3>
                    <pre>services/ifood-token-service/src/picking/
‚îú‚îÄ‚îÄ README.md                    # Documenta√ß√£o do m√≥dulo
‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îú‚îÄ‚îÄ PickingTypes.ts         # Interfaces TypeScript
‚îÇ   ‚îî‚îÄ‚îÄ PickingResponses.ts     # Tipos de resposta da API
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ PickingService.ts       # Servi√ßo principal
‚îÇ   ‚îî‚îÄ‚îÄ PickingValidation.ts    # Valida√ß√µes
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îú‚îÄ‚îÄ PickingHelpers.ts       # Fun√ß√µes auxiliares
‚îÇ   ‚îî‚îÄ‚îÄ PickingLogger.ts        # Logging espec√≠fico
‚îî‚îÄ‚îÄ __tests__/
    ‚îú‚îÄ‚îÄ PickingService.test.ts  # Testes unit√°rios
    ‚îî‚îÄ‚îÄ integration.test.ts     # Testes de integra√ß√£o</pre>
                </div>

                <div class="success-section">
                    <h3>‚úÖ Integra√ß√£o com M√≥dulos Existentes</h3>
                    <ul>
                        <li><strong>M√≥dulo de Pedidos:</strong> Utilizar eventos de pedidos para trigger de separa√ß√£o</li>
                        <li><strong>M√≥dulo de Cat√°logo:</strong> Validar produtos adicionados/editados</li>
                        <li><strong>Frontend:</strong> Interface para gest√£o de separa√ß√£o</li>
                        <li><strong>Database:</strong> Armazenar logs e estado da separa√ß√£o</li>
                    </ul>
                </div>
            </section>

            <section>
                <h2>üö® Riscos e Mitiga√ß√µes</h2>
                
                <table>
                    <thead>
                        <tr>
                            <th>Risco</th>
                            <th>Impacto</th>
                            <th>Mitiga√ß√£o</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Falha na finaliza√ß√£o</td>
                            <td>Pedido em estado inconsistente</td>
                            <td>Implementar rollback e notifica√ß√£o</td>
                        </tr>
                        <tr>
                            <td>Timeout em opera√ß√µes</td>
                            <td>Perda de dados de separa√ß√£o</td>
                            <td>Retry autom√°tico com exponential backoff</td>
                        </tr>
                        <tr>
                            <td>Viola√ß√£o de sequ√™ncia</td>
                            <td>Erro de API e poss√≠vel bloqueio</td>
                            <td>Valida√ß√£o rigorosa do estado antes de opera√ß√µes</td>
                        </tr>
                        <tr>
                            <td>Rate limit excedido</td>
                            <td>Opera√ß√µes falham temporariamente</td>
                            <td>Implementar queue e throttling</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <section>
                <h2>üìä An√°lise de Complexidade</h2>
                
                <div class="info-section">
                    <h3>üìà Estimativa de Implementa√ß√£o</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Componente</th>
                                <th>Complexidade</th>
                                <th>Tempo Estimado</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Servi√ßos Core</td>
                                <td>M√©dia</td>
                                <td>2-3 dias</td>
                            </tr>
                            <tr>
                                <td>Endpoints REST</td>
                                <td>Baixa-M√©dia</td>
                                <td>1-2 dias</td>
                            </tr>
                            <tr>
                                <td>Interface Frontend</td>
                                <td>M√©dia-Alta</td>
                                <td>3-4 dias</td>
                            </tr>
                            <tr>
                                <td>Testes e Valida√ß√£o</td>
                                <td>Alta</td>
                                <td>2-3 dias</td>
                            </tr>
                            <tr>
                                <td>Integra√ß√£o e Deploy</td>
                                <td>M√©dia</td>
                                <td>1-2 dias</td>
                            </tr>
                        </tbody>
                    </table>
                    <p><strong>Total estimado:</strong> 9-14 dias de desenvolvimento</p>
                </div>
            </section>

            <section>
                <h2>üéØ Pr√≥ximos Passos Recomendados</h2>
                
                <div class="workflow-container">
                    <div class="workflow-step">
                        <h4>Pesquisa Detalhada da API</h4>
                        <p>Obter documenta√ß√£o completa da API oficial do iFood com estruturas de dados exatas</p>
                    </div>

                    <div class="workflow-step">
                        <h4>Definir Interfaces TypeScript</h4>
                        <p>Criar tipos para requests/responses de todos os endpoints</p>
                    </div>

                    <div class="workflow-step">
                        <h4>Implementar Servi√ßos Core</h4>
                        <p>Desenvolver PickingService com todos os m√©todos necess√°rios</p>
                    </div>

                    <div class="workflow-step">
                        <h4>Criar Endpoints REST</h4>
                        <p>Integrar servi√ßos no server.ts seguindo padr√£o dos m√≥dulos existentes</p>
                    </div>

                    <div class="workflow-step">
                        <h4>Desenvolver Interface</h4>
                        <p>Criar componente React para gest√£o de separa√ß√£o</p>
                    </div>

                    <div class="workflow-step">
                        <h4>Testes Integrados</h4>
                        <p>Validar todo o fluxo com API real do iFood</p>
                    </div>
                </div>
            </section>
        </main>

        <footer>
            <div class="critical-section">
                <h3>üöÄ Conclus√£o</h3>
                <p>O m√≥dulo de Picking √© o <strong>√∫ltimo bloqueador cr√≠tico</strong> para a homologa√ß√£o completa do sistema iFood. Com os m√≥dulos de Cat√°logo, Pedidos e Merchants j√° implementados (100%), a implementa√ß√£o do Picking permitir√° a homologa√ß√£o oficial e o processamento completo de pedidos.</p>
                <p><strong>Prioridade m√°xima:</strong> Implementar todos os 5 endpoints do m√≥dulo de Picking para desbloquear a homologa√ß√£o.</p>
            </div>
            
            <div class="info-section">
                <h4>üìù Documenta√ß√£o baseada em:</h4>
                <ul>
                    <li>Crit√©rios oficiais de homologa√ß√£o iFood</li>
                    <li>Status atual do projeto (IFOOD_ENDPOINTS_PENDENTES.md)</li>
                    <li>Estrutura do projeto (PROJECT_STRUCTURE_ORGANIZED.md)</li>
                    <li>An√°lise de m√≥dulos existentes (Cat√°logo, Pedidos, Merchants)</li>
                </ul>
                <p><strong>Data da an√°lise:</strong> 27 de agosto de 2025</p>
            </div>
        </footer>
    </article>
</body>
</html>